window._.Module.define({path:"encourage-appforum/widget/app_forum_notice",sub:{ASIDE_NOTICE_TPL:'<div class="tbapp-forum-edit-wrapper"><div class="tbapp-forum-edit-container"><label>\u6a21\u5757\u540d\u79f0\uff1a</label><input id="tbapp-notice-title-edit" class="form-control"></input></div><div class="tbapp-forum-edit-container"><label>\u516c\u544a\u5185\u5bb9\uff1a</label><textarea id="tbapp-notice-content-edit"></textarea></div><div class="tbapp-forum-edit-container clearfix"><button class="btn-default btn-small app-forum-notice-submit-btn">\u786e\u8ba4\u63d0\u4ea4</button></div></div>',initial:function(t){this.$wrapper=$("#app-forum-notice-wrapper"),this.notice=t.notice||"",this.title=t.title||"",this.bindEvent()},showDialog:function(){var t=$(this.ASIDE_NOTICE_TPL),i=new $.dialog({html:t,title:"\u53f3\u4fa7\u516c\u544a\u6a21\u5757\u8bbe\u7f6e",draggable:!0,width:418});$("#tbapp-notice-content-edit").val(this.notice),$("#tbapp-notice-title-edit").val(this.title),i.element.on("click",".app-forum-notice-submit-btn",function(){var t=$("#tbapp-notice-content-edit").val(),i=$("#tbapp-notice-title-edit").val(),e="/tbapp/forum/setTbappNotice";$.post(e,{content:t,title:i,forum_id:$.getPageData("forum.id",0),tbs:$.getPageData("tbs")},function(t){0===t.no&&(alert("\u63d0\u4ea4\u6210\u529f"),$.tb.location.reload())})})},bindEvent:function(){var t=this;this.$wrapper.on("click",".j-set-notice",function(){t.showDialog()})}}});_.Module.define({path:"encourage-appforum/widget/my_app",sub:{MY_APP_THEME_KEY:"my_app_theme_cls",initial:function(a){var t=this;t._root=$(".j_encourage_entry"),$.extend(t,a),$.tb.Storage.remove("my_app_theme_cls"),"1"==t.is_pull_recommendation&&t.pullRecommendation(),t._stats()},_stats:function(){var a=this,t=a._root.find(".list50").length>0;a._root.on("click","a",function(){var e=$(this).data("log"),p=$(this).closest(".j_app_item").find(".j_app_recommend").length>0||"1"!=a.is_pull_recommendation,n={is_recommendation:p,is_50:t};$.stats.track(e,"\u53f3\u4fa7\u5165\u53e3-\u6211\u7684\u5e94\u7528",PageData.product,"click",n)}),a._viewStats(a._root,{is_50:t})},_viewStats:function(a,t){var e=!1,p=null,n=function(){e||($.stats.track("\u5c55\u73b0","\u53f3\u4fa7\u5165\u53e3-\u6211\u7684\u5e94\u7528",PageData.product,"show",t),e=!0)},_=function(){var t=a.offset().top,e=a.offset().top+a.height(),p=$("body").scrollTop(),n=$(window).height()+p,_=!1;return(t>p&&n>=t||e>p&&n>=e)&&(_=!0),_};_()?n():$(window).on("scroll",function(){_()&&(clearTimeout(p),p=setTimeout(n,200))})},setTheme:function(){var a=this,t="list50",e="list60",p=$.tb.Storage.get(a.MY_APP_THEME_KEY);p||(p="1"==a.is_pull_recommendation?a.user_id%2==0?t:e:a.random(0,99)%2==0?t:e,$.tb.Storage.set(a.MY_APP_THEME_KEY,p)),a._root.find(".j_app_list").addClass(p)},random:function(a,t){return null==t&&(t=a,a=0),a+Math.floor(Math.random()*(t-a+1))},pullRecommendation:function(){var a=this,t={ie:"utf-8",tbs:PageData.tbs};a._ajax&&a._ajax.abort(),a._ajax=$.ajax({type:"post",url:"/tbapp/user/getRecommendApp",data:t,dataType:"json"}).success(function(t){t&&0===t.no&&a.renderAppList(t.data)})},renderAppList:function(a){var t=this,e=0;t.wrapper=$(".j_encourage_entry");for(var p="",n='<li  class="media_vertical app_icon_wrap j_app_item #{last_app_item}"><div class="media_top"><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank" class="app_icon_link"  title="#{app_name}"><img src="#{app_img}"></a>#{recommend_title}</div><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank"  class="media_bottom text_overflow"  title="#{app_name}">#{app_name}</a></li>',_=0,i=a.length;i>_&&12>_;_++){var o=a[_],r={last_app_item:(_+1)%3===0?"last_app_item":"",app_name:o.forum_name,app_img:o.forum_portrait_image,recommend_title:1==o.type?(e++,'<span  class="j_app_recommend media_caption app_recommend">\u8350</span>'):""};p+=$.tb.format(n,r)}var s=t.wrapper.find(".j_add_app_item");12==a.length?s.hide():s.show(),t.wrapper.find(".j_app_list").prepend(p),e==a.length?(t.wrapper.find(".j_encourage_title").html("\u63a8\u8350\u5e94\u7528"),t.wrapper.find(".j_app_recommend").hide()):(t.wrapper.find(".j_encourage_title").html("\u6211\u7684\u5e94\u7528"),t.wrapper.find(".j_app_recommend").show())}}});